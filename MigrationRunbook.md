# Migration runbook

## Prerequisites 

Prerequisites                                                                                                              |Comment                                                                                                                                                                                                                                                                                                                                |Executed                |Additional resources/References                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
---------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Review migration types and select most appropriate tools for assessment and migration                                      |Decision based on virtualization platform & version, OS version, access to virtualization hosts, etc.                                                                                                                                                                                                                                  |Once                    |[https://docs.microsoft.com/en-us/azure/migrate/migrate-services-overview#integrated-tools](https://docs.microsoft.com/en-us/azure/migrate/migrate-services-overview#integrated-tools)                                                                                                                                                                                                                                                                                                                       
Verify Migration limitations and plan Migration strategy accordingly                                                       |Assessment of up to 35,000 servers in a single Azure Migrate Project…<br>Verify support matrix for compatibility of virtualization platform and/or physical servers and VMs                                                                                                                                                            |Once                    |https://docs.microsoft.com/en-us/azure/migrate/prepare-for-migration#verify-migration-limitations<br>https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix                                                                                                                                                                                                                                                                                                                                   
Configure and verify source host prerequisites are in place                                                                |Varies for Hyper-V, VMware or Physical server / other virtualization platform                                                                                                                                                                                                                                                          |Per host/physical server|[https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#vmware-requirements<br>https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-hyper-v#hyper-v-host-requirements<br>https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-physical#physical-server-requirements](https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#vmware-requirements)                                                                               
Prepare Azure environment                                                                                                  |Varies for Hyper-V, VMware or Physical server / other virtualization platform:<br>\- Create an Azure Migrate project<br>\- Register resource providers<br>\- Create Azure AD apps<br>\- Create a Key Vault                                                                                                                             |Once                    |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-vmware#prepare-azure<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-hyper-v#prepare-azure<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-physical#prepare-azure-for-server-assessment<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-physical#prepare-azure-for-physical-server-migration](https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-vmware#prepare-azure)
Prepare VMware, Hyper-V platform and Physical server infra                                                                 |Includes specific permissions, configurations and installations required at on-prem platform level. Varies for Hyper-V, VMware or Physical server / other virtualization platform<br><br>Additional tasks might include instalation of agents on Hyper-V hosts or Mobility service on VMs/physical servers, depending of migration type|Per host/physical server|[https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-vmware<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-hyper-v<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-physical<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-hyper-v#prepare-hyper-v-hosts](https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-vmware)                                                                                                     
Prepare VMs/physical servers for assessment and migration                                                                  |Depending on migration type, some changes might be required on VMs/physical servers<br>                                                                                                                                                                                                                                                |Once                    |https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-physical#prepare-for-physical-server-assessment<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-physical#prepare-for-physical-server-migration<br>                                                                                                                                                                                                                                                                        
Configure firewall requirements                                                                                            |Enable connectivity between appliances and Azure<br>Enable connectivity between source servers/VMs and appliance                                                                                                                                                                                                                       |Once                    |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware#prepare-vms-for-migration<br>https://docs.microsoft.com/en-us/azure/migrate/common-questions-appliance#what-network-connectivity-is-needed<br>https://docs.microsoft.com/en-us/azure/migrate/migrate-replication-appliance#url-access](https://docs.microsoft.com/en-us/azure/migrate/common-questions-appliance#what-network-connectivity-is-needed)                                                                                
Deploy Azure Migrate appliance(s)                                                                                          |Depending on chosen migration type(s), multiple appliances may be required, such as replication appliance<br>                                                                                                                                                                                                                          |Once                    |[https://docs.microsoft.com/en-us/azure/migrate/how-to-set-up-appliance-vmware<br>https://docs.microsoft.com/en-us/azure/migrate/how-to-set-up-appliance-hyper-v<br>https://docs.microsoft.com/en-us/azure/migrate/how-to-set-up-appliance-physical](https://docs.microsoft.com/en-us/azure/migrate/how-to-set-up-appliance-vmware)                                                                                                                                                                          
Verify required networking for target environment is deployed in Azure                                                     |Consider DNS configuration, internet connectivity, security…                                                                                                                                                                                                                                                                           |Once                    |[https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview](https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview)                                                                                                                                                                                                                                                                                                                                         
Verify hybrid network connectivity between on-prem and Azure                                                               |Using VPN or ExpressRoute                                                                                                                                                                                                                                                                                                              |Once                    |[https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/)                                                                                                                                                                                                                                                                                                             
Network bandwidth planning and routing requirements (if required)                                                          |Capacity Planner will help with estimating network bandwidth required for migration                                                                                                                                                                                                                                                    |Once                    |[https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-capacity-planner#run-the-quick-planner](https://docs.microsoft.com/en-us/azure/site-recovery/site-recovery-capacity-planner#run-the-quick-planner)                                                                                                                                                                                                                                                                                       
Setup a dedicated VNET or a subnet (locked down with NSG) under existing VNET for test failover of servers during migration|During migration test failover, temp failover VM should be in an isolated environment to avoid DNS and production application conflicts.                                                                                                                                                                                               |Once                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
Set up Log Analytics workspace for dependency visualisation using Service Map (optional)                                   |Decide on using agent-based or agentless dependencies visualizatuon and set up prerequisites                                                                                                                                                                                                                                           |Once                    |[https://docs.microsoft.com/en-us/azure/migrate/how-to-create-group-machine-dependencies<br>https://docs.microsoft.com/en-us/azure/migrate/how-to-create-group-machine-dependencies-agentless](https://docs.microsoft.com/en-us/azure/migrate/how-to-create-group-machine-dependencies)                                                                                                                                                                                                                      
Deploy Log Analytics gateway if needed (optional)                                                                          |Deploy when computers cannot directly connect to internet to access Azure Monitor                                                                                                                                                                                                                                                      |Once                    |[https://docs.microsoft.com/en-us/azure/azure-monitor/platform/gateway](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/gateway)                                                                                                                                                                                                                                                                                                                                                               
Deploy MMA and Dependency agents on each machine                                                                           |Dependency agents are required when using agent-based dependency visualization<br>                                                                                                                                                                                                                                                     |Per server              |[https://docs.microsoft.com/en-us/azure/azure-monitor/platform/log-analytics-agent#installation-and-configuration<br>https://docs.microsoft.com/en-gb/azure/migrate/concepts-dependency-visualization](https://docs.microsoft.com/en-gb/azure/migrate/concepts-dependency-visualization)                                                                                                                                                                                                                    

## Assessment

Assessment Activities                                                         |Comment                                                                                                                                                                                                                                          |Executed                       |Additional resources                                                                                                                                                                                                                                                                                                                                                                                                                           
------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Interview business/app owners, gather requirements and dependencies           |It is critical to undersand application requirements, licensing, dependencies<br>that tools can't discover                                                                                                                                       |Per application/ workload      
Identify/document required UAT test after migration                           |Gather tests that needs to be run after migration to validate app is performing<br>as expected                                                                                                                                                   |Per application/ workload      
Verify all VM/server assessment prerequisites are in place                    |Verify that all steps for chosen assessment type are in place                                                                                                                                                                                    |Per server                     |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-vmware#prepare-for-vmware-vm-assessment<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-hyper-v#prepare-hyper-v-for-assessment<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-physical#prepare-for-physical-server-assessment](https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-vmware#prepare-for-vmware-vm-assessment)
Start continuous discovery and gather data over period of time                |It is recommended to gather performance and dependecy data over longer period<br>of time to get more accurate results (for example over period of 5 weeks)                                                                                       |Once                           |                                                                                                                                                                                                                                                                                                                                                                                                                                               
Create assessment in Azure Migrate Project                                    |After data has been gathered over period of time, create assessment with appropriate parameters. If required create multiple groups for assessment. You can create multiple assessment with different parameters.                                |As required                    |[https://docs.microsoft.com/en-us/azure/migrate/best-practices-assessment<br>https://docs.microsoft.com/en-us/azure/migrate/how-to-create-a-group<br>https://docs.microsoft.com/en-us/azure/migrate/best-practices-assessment<br>https://docs.microsoft.com/en-us/azure/migrate/how-to-modify-assessment](https://docs.microsoft.com/en-us/azure/migrate/best-practices-assessment)                                                            
Assess Azure suitability/compatibility                                        |Establish if VM can be moved to Azure/identify changes required                                                                                                                                                                                  |Per server                     |[https://support.microsoft.com/en-us/help/2721672/microsoft-server-software-support-for-microsoft-azure-virtual-machines<br>https://docs.microsoft.com/en-us/azure/virtual-machines/linux/endorsed-distros](https://support.microsoft.com/en-us/help/2721672/microsoft-server-software-support-for-microsoft-azure-virtual-machines)                                                                                                           
Identify dependencies                                                         |Using tooling and interviews from app owners                                                                                                                                                                                                     |Per server                     |[https://docs.microsoft.com/en-us/azure/migrate/how-to-create-group-machine-dependencies-agentless#visualize-dependencies](https://docs.microsoft.com/en-us/azure/migrate/how-to-create-group-machine-dependencies-agentless#visualize-dependencies)                                                                                                                                                                                           
Performance monitoring (optional)                                             |In case of specific requirements or complex applications, implement additional<br>performance monitoring to better select VM size and sotrage type in Azure                                                                                      |Per server                     
Sizing based on performance requirements (VM Size, Storage configuration/tier)|Adjust sizing recommendations based on interviews with application owners                                                                                                                                                                        |Per server                     
Group machines based on interviews and discovered dependencies                |Prepare group of servers/VMs that will be migrated in same batch and assign servers/VMs to groups.<br>Consider utilizing manual grouping based on existing application architecture documentation, tools (CMDB) and application owners interviews|Per workload or migration group|[https://docs.microsoft.com/en-us/azure/migrate/how-to-create-a-group](https://docs.microsoft.com/en-us/azure/migrate/how-to-create-a-group)                                                                                                                                                                                                                                                                                                    

## Pre-migration activities

Pre-migration Activities                                                      |Comment                                                                                                                                                                                               |Executed   |Additional resources                                                                                                                                                                                                                                                                                                                                                                                                    
------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Verify assessment results and dependencies are up to date                     |Use recent assessment and dependency analysis results                                                                                                                                                 |As required
Submit change requests if required to obtain access and implement requirements|As required                                                                                                                                                                                           
Obtain and verify Access to server with required permissions are in place     |In order to complete any installation/reconfiguration required on server/VM                                                                                                                           |Per server 
Install replication agents (if required)                                      |In case of using Agent-based migration                                                                                                                                                                |Per server |[https://docs.microsoft.com/en-us/azure/migrate/agent-based-migration-architecture](https://docs.microsoft.com/en-us/azure/migrate/agent-based-migration-architecture)                                                                                                                                                                                                                                                  
In case of existing agent based replication DR resolve conflicts (if required)|As required                                                                                                                                                                                           
Verify required changes before migration                                      |Prepare VM to run in Azure before migration, consider things like connectivity, SSH/RDP access, Hyper-V Integration services,<br>access to Serial Console, Drive letters/device persistance,…         |Per server |[https://docs.microsoft.com/en-us/azure/migrate/prepare-for-migration](https://docs.microsoft.com/en-us/azure/migrate/prepare-for-migration)                                                                                                                                                                                                                                                                            
Pre-migration health check (OS, Apps, DBs)                                    |Verify health of server/VM and its workloads before migration                                                                                                                                         |Per server 
Initiate replication                                                          |Initiate server replication to Azure                                                                                                                                                                  |Per server |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware#replicate-vms<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-hyper-v#replicate-hyper-v-vms<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-physical-virtual-machines#replicate-machines](https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware#replicate-vms)                           
Verify replication state                                                      |Track and monitor status of replication                                                                                                                                                               |Per server |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware#track-and-monitor<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-hyper-v#track-and-monitor<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-physical-virtual-machines#track-and-monitor](https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-physical-virtual-machines#track-and-monitor)     
Initiate test failover                                                        |It is strongly recommended to perform test failover to verify VM boots in Azure and loads as expected. Note that might be challenging to verify application health if using isolated test environments|Per server |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware-agent#run-a-test-migration<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-hyper-v#run-a-test-migration<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-physical-virtual-machines#run-a-test-migration](https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware-agent#run-a-test-migration)
Verify success of test failover and state of test replica                     |Per server                                                                                                                                                                                            
Assess and document DNS configuration/records for server/VM                   |To be able to apply any chages to DNS if required after migration                                                                                                                                     |Per server 
Assess network requirements for server/VM                                     |Discover and document network requirements for VM, such as:<br>\- Firewall networking rules<br>\- Load balancing requirements                                                                         |Per server 
Change Netowrk Firewall/NSG configuration on target environment               |Configure any required network changes to that migrated server/VM requires in<br>target environment                                                                                                   |Per server 

## Migration activities

Migration Activities                           |Comment                                                                    |Executed                                                                                                                                                                                                                                                                                                                                                                                                             |Additional resources                                                                                                                                                                                                                                                                                                                                                                       
-----------------------------------------------|---------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Notify owners on migration/get approvals       |Notify and get approvals for migration from application owners             |Per server                                                                                                                                                                                                                                                                                                                                                                                                           
Perform migration/failover                     |Initate Migration from Azure Migrate project                               |Per server                                                                                                                                                                                                                                                                                                                                                                                                           |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware#migrate-vms<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-hyper-v#migrate-vms<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-physical-virtual-machines#migrate-vms](https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-physical-virtual-machines#migrate-vms)
Verify success of migration                    |Track migration and verify success in Azure Migrate project                |Per server                                                                                                                                                                                                                                                                                                                                                                                                           
Test network connectivity                      |Validate that all required connectivity is in place/fix issues if needed   |Per server                                                                                                                                                                                                                                                                                                                                                                                                           
DNS changes                                    |Implement any required DNS changes                                         |Per server                                                                                                                                                                                                                                                                                                                                                                                                           
Update Active Directory objects (if requred)   |Consider changes to computer object OU…                                    |Per server                                                                                                                                                                                                                                                                                                                                                                                                           
Azure Load Balancer configuration (if required)|Per server                                                                 
Update application settings                    |Update any application configuration such as connection strings if required|Per server                                                                                                                                                                                                                                                                                                                                                                                                           
Verify state of Applications/Services          |Verify OS and applications running in VM are running healthy               |Per server                                                                                                                                                                                                                                                                                                                                                                                                           
UAT tests                                      |Perform UAT tests documented in assessment stage                           |Per server                                                                                                                                                                                                                                                                                                                                                                                                           
Verify Azure agent is deployed                 |VMs require Azure agent installed for full Azure integration               |Per server                                                                                                                                                                                                                                                                                                                                                                                                           |[https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/agent-windows<br>https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/agent-linux](https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/agent-windows)                                                                                                                                     
Configure monitoring                           |Configure/verify monitoring with selected tool                             |Per server                                                                                                                                                                                                                                                                                                                                                                                                           |[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/monitor](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/monitor)                                                                                                                                                                                                                                         
Configure Antimalware                          |Configure/verify VM protection with selected tool                          |Per server                                                                                                                                                                                                                                                                                                                                                                                                           |[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/security-policy#antimalware](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/security-policy#antimalware)                                                                                                                                                                                                 
Enable backup                                  |Enable backup of VM with selected tool                                     |Per server                                                                                                                                                                                                                                                                                                                                                                                                           |[https://docs.microsoft.com/en-us/azure/backup/quick-backup-vm-portal](https://docs.microsoft.com/en-us/azure/backup/quick-backup-vm-portal)                                                                                                                                                                                                                                               
Enable patching                                |Enable update management with selected tool                                |Per server                                                                                                                                                                                                                                                                                                                                                                                                           |[https://docs.microsoft.com/en-us/azure/automation/automation-update-management](https://docs.microsoft.com/en-us/azure/automation/automation-update-management)                                                                                                                                                                                                                     
Install SQL IaaS Agent Extension               |SQL IaaS Agent Extension runs on SQL Server on Azure Virtual Machines (VMs) to automate management and administration tasks. | Per server/Or bulk installation |[https://docs.microsoft.com/en-us/azure/azure-sql/virtual-machines/windows/sql-agent-extension-manually-register-single-vm](https://docs.microsoft.com/en-us/azure/azure-sql/virtual-machines/windows/sql-agent-extension-manually-register-single-vm) 
Complete migration/failback if required        ||Per server                                                                 |[https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware#complete-the-migration<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-hyper-v#complete-the-migration<br>https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-physical-virtual-machines#complete-the-migration](https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-hyper-v#complete-the-migration)


## Post-migration activities

Post-migration Activities|Comment                                                                 |Executed                                                                                                                                  |Additional resources
-------------------------|------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|--------------------
Update tagging/naming    |Add/update any Tags in Azure                                            |[https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tag](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tag)
Update CMDB              |Update CMDB with required changes                                       
Signoff                  |Signoff on completed server/VM migration                                
Decommission             |Decomission any on-prem systems thet were required (monitoring, backup…)
